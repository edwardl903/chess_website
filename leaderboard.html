<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess.com Daily Leaderboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        #leaderboard-table {
            width: 100%;
            border-collapse: collapse;
        }

        #leaderboard-table th,
        #leaderboard-table td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        #leaderboard-table th {
            background-color: #f2f2f2;
            text-align: left;
        }

        #leaderboard-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Chess.com Leaderboards</h1>
    <div id="buttons">
        <button onclick="fetchAndDisplayLeaderboard('daily')">Daily</button>
        <button onclick="fetchAndDisplayLeaderboard('live_rapid')">Rapid</button>
        <button onclick="fetchAndDisplayLeaderboard('live_blitz')">Blitz</button>
        <button onclick="fetchAndDisplayLeaderboard('live_bullet')">Bullet</button>
        
        
    </div>
    <table id="leaderboard-table">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Username</th>
                <th>Score</th>
                <th>Country</th>
            </tr>
        </thead>
        <tbody id="leaderboard-body">
            <!-- The fetched leaderboard data will be displayed here -->
        </tbody>
    </table>

    <script>
        const apiUrl = 'https://api.chess.com/pub/leaderboards';
        const restCountriesApiUrl = 'https://restcountries.com/v3.1/alpha';

        // Function to fetch and display the specified leaderboard
        async function fetchAndDisplayLeaderboard(leaderboardType) {
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                if (data && data[leaderboardType]) {
                    const players = data[leaderboardType];
                    const playerDataWithCountries = await fetchCountryNames(players);
                    displayLeaderboard(playerDataWithCountries);
                } else {
                    throw new Error('Invalid leaderboard type or data structure in the API response');
                }
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
            }
        }

        // Function to fetch country names using REST Countries API
        async function fetchCountryNames(players) {
            const playerDataWithCountries = [];
            for (const player of players) {
                try {
                    const countryResponse = await fetch(`${restCountriesApiUrl}/${player.country}`);
                    if (!countryResponse.ok) {
                        throw new Error('Country data not found');
                    }
                    const countryData = await countryResponse.json();
                    playerDataWithCountries.push({ ...player, country: countryData.name });
                } catch (error) {
                    console.error(`Error fetching country data for ${player.country}:`, error);
                    playerDataWithCountries.push({ ...player, country: 'Unknown' });
                }
            }
            return playerDataWithCountries;
        }

        // Function to display the leaderboard
        function displayLeaderboard(players) {
            const leaderboardBody = document.getElementById('leaderboard-body');
            leaderboardBody.innerHTML = '';
            players.slice(0, 50).forEach((player, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player.username}</td>
                    <td>${player.score}</td>
                    <td>${player.country}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }

        // Call the fetchAndDisplayLeaderboard function with the 'daily' leaderboard on page load
        fetchAndDisplayLeaderboard('daily');
    </script>
</body>
</html>